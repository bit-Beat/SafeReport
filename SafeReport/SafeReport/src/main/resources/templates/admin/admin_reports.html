<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" type="text/css" href="/static/bootstrap.min.css">

</head>
<body>
	<div layout:fragment="content">
		
    <div class="container mt-5 mb-3  text-truncate">
        <!-- Ï†úÎ™© Î∞è ÌÜµÍ≥Ñ ÎßÅÌÅ¨ -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-primary">Í¥ÄÎ¶¨Ïûê Ï†úÎ≥¥ Í¥ÄÎ¶¨</h1>
            <a href="/admin/statistics" class="btn btn-outline-primary">üìä ÌÜµÍ≥Ñ Î≥¥Í∏∞</a>
        </div>

        <!-- Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞ -->
        <form method="get" th:action="@{/admin/reports}" class="mb-4" id="searchForm">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="text" name="keyword" class="form-control" placeholder="Ï†úÎ™©/ÏûëÏÑ±Ïûê Í≤ÄÏÉâ" th:value="${keyword}" autocomplete="off">
                </div>

                <div class="col-md-3">
                    <select name="riskGrade" class="form-select">
						<option selected value="null" >ÏúÑÌóò Îì±Í∏â ÏÑ†ÌÉù</option>
						<option th:each="grade : ${T(com.example.SafeReport.Enum.RiskGrade).values()}"
						        th:value="${grade.name()}"
						        th:text="${grade.getDescription}"
								th:selected="${selectedRiskGrade == grade.name()}">
						</option>
                    </select>
                </div>
				
				<div class="col-md-3">
					<select name="status" class="form-select">
					    <option disabled hidden selected value="">ÏÉÅÌÉú ÏÑ†ÌÉù</option>
					    <option th:each="status : ${T(com.example.SafeReport.Enum.RiskStatus).values()}"
					            th:value="${status.name()}"
					            th:text="${status.getDescription}"
								th:selected="${selectedStatus == status.name()}">
						</option>
					</select>
				</div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">Í≤ÄÏÉâ</button>
                </div>
            </div>
        </form>

        <!-- Ï†úÎ≥¥ Î™©Î°ù -->
        <div class="card d-block text-truncate">
            <div class="card-body text-truncate">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Î≤àÌò∏</th>
                            <th>Ï†úÎ™©</th>
                            <th>ÏûëÏÑ±Ïûê</th>
                            <th>ÏúÑÌóò Îì±Í∏â</th>
                            <th>ÏÉÅÌÉú</th>
                            <th>ÏûëÏÑ±Ïùº</th>
                            <th>Í¥ÄÎ¶¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="report, loop : ${report}">
                            <td th:text="${loop.count}"></td>
                            <td th:text="${report.report_title}"></td>
                            <td th:text="${report.reporter_name}"></td>
                            <td>
								<span th:classappend="${report.risk.riskGrade != null ?
														(report.risk.riskGrade == T(com.example.SafeReport.Enum.RiskGrade).A ? 'badge text-bg-danger' : 
										                report.risk.riskGrade == T(com.example.SafeReport.Enum.RiskGrade).B ? 'badge text-bg-warning' : 
										                report.risk.riskGrade == T(com.example.SafeReport.Enum.RiskGrade).C ? 'badge text-bg-primary' : 
										                report.risk.riskGrade == T(com.example.SafeReport.Enum.RiskGrade).D ? 'badge text-bg-success' : 
										                'badge text-bg-light') : 'badge text-bg-light'}" 
										th:text="${report.risk.riskGrade.description}">
								</span>
                            </td>
                            <td>
								<span th:classappend="${report.risk.status == T(com.example.SafeReport.Enum.RiskStatus).PENDING ? 'badge text-bg-secondary' : 
								                      report.risk.status == T(com.example.SafeReport.Enum.RiskStatus).REVIEWED ? 'badge text-bg-primary' : 
								                      report.risk.status == T(com.example.SafeReport.Enum.RiskStatus).DISCUSSING ? 'badge text-bg-danger' : 
								                      report.risk.status == T(com.example.SafeReport.Enum.RiskStatus).IN_PROGRESS ? 'badge text-bg-warning' : 
								                      report.risk.status == T(com.example.SafeReport.Enum.RiskStatus).COMPLETED ? 'badge text-bg-success' : 
								                      'badge text-bg-light'}" 
								      th:text="${report.risk.status.getDescription}">
								</span>
                            </td>

                            <td th:text="${#temporals.format(report.reportcreatedate, 'yyyy-MM-dd HH:mm')}"></td>
                            <td>
                                <a th:href="@{/admin/reports/{id}(id=${report.reportid})}" class="btn btn-sm btn-outline-primary btn-action">ÏÉÅÏÑ∏</a>
                                <form th:action="@{|/report/delete/${report.reportid}|}" method="post" style="display:inline;">
                                    <button type="submit" class="btn btn-sm btn-outline-danger btn-action" onclick="return confirm('Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')" sec:authorize="hasRole('ROLE_ADMIN')">ÏÇ≠Ï†ú</button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
	
	<!-- ÌéòÏù¥ÏßïÏ≤òÎ¶¨ ÏãúÏûë -->
	<div th:if="${!report.isEmpty()}">
		<ul class="pagination justify-content-center">
		    <!-- Previous Page -->
		    <li class="page-item" th:classappend="${report.number == 0} ? 'disabled'">
		        <a class="page-link" th:href="@{/admin/reports(page=${report.number}, keyword=${keyword}, status=${selectedStatus}, riskGrade=${selectedRiskGrade})}">&laquo;</a>
		    </li>

		    <!-- Page Numbers -->
		    <li th:each="page : ${#numbers.sequence(1, report.totalPages)}" 
		        th:classappend="${page - 1 == report.number} ? 'active'" 
		        class="page-item">
		        <a class="page-link" th:href="@{/admin/reports(page=${page}, keyword=${keyword}, status=${selectedStatus}, riskGrade=${selectedRiskGrade})}" 
		           th:text="${page}"></a>
		    </li>

		    <!-- Next Page -->
		    <li class="page-item" th:classappend="${report.number + 1 == report.totalPages} ? 'disabled'">
		        <a class="page-link" th:href="@{/admin/reports(page=${report.number + 2}, keyword=${keyword}, status=${selectedStatus}, riskGrade=${selectedRiskGrade})}">&raquo;</a>
		    </li>
		</ul>
	</div>
	<!-- ÌéòÏù¥ÏßïÏ≤òÎ¶¨ ÎÅù -->
	   
	</div>
</body>
</html>
