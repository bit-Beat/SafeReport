<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
	<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="stylesheet" type="text/css" href="/static/bootstrap.min.css">
	
	<style>
	        body {
	            background-color: #f8f9fa; /* í˜ì´ì§€ ë°°ê²½ìƒ‰ */
	        }

	        .form-container {
	            background-color: #ffffff; /* í¼ ë°°ê²½ */
	            padding: 30px;
	            border-radius: 15px;
	            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì íš¨ê³¼ */
	        }


	        label {
	            font-weight: 500;
	        }

	    </style>
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	<script>
	    window.onload = function () {
	        if (window.location.search.includes("success")) {
	            alert("ì œë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
	        }
	    }
		function removeListItem(button) {
			if(!confirm("ì²¨ë¶€íŒŒì¼ì„ ì‚­ì œí•˜ì‹œë©´ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.\nì²¨ë¶€íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))
				return;
				
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");

			// í˜„ì¬ URLì—ì„œ ID ì¶”ì¶œ
			const pathSegments = window.location.pathname.split("/"); // URLì„ '/'ë¡œ ë¶„ë¦¬
			const id = pathSegments[pathSegments.length - 1]; // ë§ˆì§€ë§‰ ê°’ ì¶”ì¶œ (ì˜ˆ: 112)
			
			// AJAX ìš”ì²­
			fetch("/report/modify/filedelete/"+id, {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
					[header]: token, // ë™ì ìœ¼ë¡œ CSRF í—¤ë” ì¶”ê°€
				},
				body: JSON.stringify({id:id}),
			})
			.then((response) => response.json())
			.then(data => {
				if(data.success)
				{
					const listItem = button.closest('li'); // ë²„íŠ¼ì˜ ê°€ì¥ ê°€ê¹Œìš´ <li> ìš”ì†Œ ì°¾ê¸°
					if (listItem) {
						button.remove();
						listItem.querySelector('a').remove();

						if (!listItem.querySelector('del')) { // ì´ë¯¸ ê°ì‹¸ì ¸ ìˆì§€ ì•Šì€ ê²½ìš°ë§Œ ì²˜ë¦¬
					        const delElement = document.createElement('del'); // <del> íƒœê·¸ ìƒì„±
					        while (listItem.firstChild) 
					            delElement.appendChild(listItem.firstChild); // <li>ì˜ ìì‹ ìš”ì†Œë¥¼ <del>ë¡œ ì´ë™
							listItem.appendChild(delElement); // <del>ì„ <li>ì— ì¶”ê°€
						}
					}
				} else {
					alert("íŒŒì¼ ì‚­ì œ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
				}
			    //console.log("íŒŒì¼ ì‚­ì œ ì‘ë‹µ:", data); // ì„±ê³µì ìœ¼ë¡œ ì‚­ì œëœ ê²½ìš°
			})
			.catch(error => {
			    console.error("íŒŒì¼ ì‚­ì œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜:", error);
			    alert("íŒŒì¼ ì‚­ì œ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
			});
		}
	</script>
</head>

<body >
	<div layout:fragment="content" class="container-fluid">
		<div class="container mt-5"> <!--ë§ˆì§„íƒ‘ 5-->
			<div class="form-container mx-auto" style="max-width: 2000px;">
				<h2 class="text-center mb-4">ğŸ“¢ í˜„ëŒ€íŒŒí…ìŠ¤ ì•ˆì „ì‹ ë¬¸ê³ ì œë³´ <p style="font-size: 0.9rem; font-family:Gothic A1; margin-top: 8px;">ì•ˆì „ ìœ„í—˜ìš”ì¸/ìš”ì†Œë¥¼ ê°€ê°ì—†ì´ ì œë³´í•´ì£¼ì„¸ìš”.</p> </h2>

		    <form method="post" th:object="${reportForm}" enctype="multipart/form-data">
				<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
				<div class="alert alert-danger" role="alert" th:if="${#fields.hasAnyErrors()}">
				    <div th:each="err : ${#fields.allErrors()}" th:text="${err}"/>
				</div>

				<div class="mb-3">
					<label for="reportTitle" class="form-label" >ì‹ ê³  ì œëª©</label>
					<input th:field="*{reportTitle}" type="text" class="form-control form-control-sm" name="reportTitle" id="reportTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
				</div>
				   
				<div class="mb-3">
					<select class="form-select visually-hidden" name="reportDepartment" id="reportDepartment" tabindex="-1">
					    <option disabled hidden 
					        th:selected="${reportForm.reportDepartment == null}" 
					        value="ì†Œì†ì„ ì„ íƒí•´ì£¼ì„¸ìš”.">
					        ì†Œì†ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
					    </option>
					    <optgroup label="í˜„ëŒ€íŒŒí…ìŠ¤">
					        <option th:value="ê´€ë¦¬ì§€ì›íŒ€" 
					                th:selected="${reportForm.reportDepartment == 'ê´€ë¦¬ì§€ì›íŒ€'}">ê´€ë¦¬ì§€ì›íŒ€</option>
					        <option th:value="ì•ˆì „í™˜ê²½íŒ€" 
					                th:selected="${reportForm.reportDepartment == 'ì•ˆì „í™˜ê²½íŒ€'}">ì•ˆì „í™˜ê²½íŒ€</option>
					        <option th:value="ì‚¬ì—…ê¸°íšíŒ€" 
					                th:selected="${reportForm.reportDepartment == 'ì‚¬ì—…ê¸°íšíŒ€'}">ì‚¬ì—…ê¸°íšíŒ€</option>
					        <option th:value="ì¬ê²½íŒ€" 
					                th:selected="${reportForm.reportDepartment == 'ì¬ê²½íŒ€'}">ì¬ê²½íŒ€</option>
					        <option th:value="ìì¬ê´€ë¦¬íŒ€" 
					                th:selected="${reportForm.reportDepartment == 'ìì¬ê´€ë¦¬íŒ€'}">ìì¬ê´€ë¦¬íŒ€</option>
					        <option th:value="í”„ë ˆìŠ¤ì§€ì›íŒ€" 
					                th:selected="${reportForm.reportDepartment == 'í”„ë ˆìŠ¤ì§€ì›íŒ€'}">í”„ë ˆìŠ¤ì§€ì›íŒ€</option>
					        <option th:value="ì°¨ì²´ì§€ì›íŒ€" 
					                th:selected="${reportForm.reportDepartment == 'ì°¨ì²´ì§€ì›íŒ€'}">ì°¨ì²´ì§€ì›íŒ€</option>
					        <option th:value="í’ˆì§ˆë³´ì¦íŒ€" 
					                th:selected="${reportForm.reportDepartment == 'í’ˆì§ˆë³´ì¦íŒ€'}">í’ˆì§ˆë³´ì¦íŒ€</option>
					    </optgroup>
					    <option th:value="SMP" 
					            th:selected="${reportForm.reportDepartment == 'SMP'}">SMP</option>
					    <option th:value="JSíŒŒíŠ¸ë„ˆìŠ¤" 
					            th:selected="${reportForm.reportDepartment == 'JSíŒŒíŠ¸ë„ˆìŠ¤'}">JSíŒŒíŠ¸ë„ˆìŠ¤</option>
					    <option th:value="í˜‘ì„±í…Œí¬" 
					            th:selected="${reportForm.reportDepartment == 'í˜‘ì„±í…Œí¬'}">í˜‘ì„±í…Œí¬</option>
						<option th:value="í•œêµ­ë©”íƒˆ" 
								th:selected="${reportForm.reportDepartment == 'í•œêµ­ë©”íƒˆ'}">í•œêµ­ë©”íƒˆ</option>
						<option th:value="ì„œì˜" 
								th:selected="${reportForm.reportDepartment == 'ì„œì˜'}">ì„œì˜</option>
					</select>

				</div>

				<div class="mb-3">
					<input th:field="*{reporterId}" type="text" class="form-control form-control-sm visually-hidden" name="reporterId" id="reporterId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off" tabindex="-1">
				    <input th:field="*{reporterName}" type="text" class="form-control form-control-sm visually-hidden" name="reporterName" id="reporterName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off" tabindex="-1">
				</div>

				<div class="mb-3">
					<label for="reportLocation" class="form-label">ë°œìƒìœ„ì¹˜</label>
					<input th:field="*{reportLocation}" type="text" class="form-control form-control-sm" name="reportLocation" id="reportLocation" placeholder="ë°œìƒìœ„ì¹˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”." autocomplete="off">
				</div>
				   
				<div class="mb-3">
					<label for="reportContent" class="form-label">ì‹ ê³  ë‚´ìš©</label>
					<textarea th:field="*{reportContent}" class="form-control form-control-sm" name="reportContent" id="reportContent" rows="5" placeholder="ì‹ ê³  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off"></textarea>
				</div>
				
				<div class="mb-3">
					<label for="reportDetails" class="form-label">ê°œì„  ìš”ì²­</label>
					<textarea th:field="*{reportDetails}" class="form-control form-control-sm" name="reportDetails" id="reportDetails" rows="5" placeholder="ê°œì„ í•˜ê³ ì‹¶ì€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off"></textarea>
				</div>
								
				<div class="mb-3">
					<label for="reportImage" class="form-label">ì´ë¯¸ì§€ ì²¨ë¶€<small class="ms-2" style="color: dimgray;">íŒŒì¼ ì‚¬ì´ì¦ˆëŠ” 10MBë¥¼ ë„˜ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</small></label>
					<input class="form-control form-control-sm" type="file" name="photo" id="photo" accept="image/*">
						
					<div class="mb-2 mt-2" th:if="${reportForm.existingPhotoName}!=''AND ${reportForm.existingPhotoName}!=NULL">
						<ul class="list-group ">
						  <li class="list-group-item d-flex align-items-center" >
							<i class="bi bi-image me-2" th:if="${reportForm.existingPhotoName.endsWith('.jpg')} or ${reportForm.existingPhotoName.endsWith('.png')}"></i>
						   	<span th:text = "${reportForm.existingPhotoName}"> A list item</span>
							<a th:href="@{'/uploads/' + ${reportForm.uuidPhotoName}}" 
								target="_blank" 
								class="btn btn-link btn-sm">
								<i class="bi bi-search"></i>
							</a>
							
							<button type="button" class="btn-close" aria-label="Close" onclick="removeListItem(this)"></button>
						  </li>
						</ul>
					</div>
				</div>
				
		        <div class="d-grid gap-2">
					<button type="submit" class="btn btn-primary">ì €ì¥</button>
				</div>
		       </form>
		   </div>
		</div>
	</div>
	
</body>
</html>
